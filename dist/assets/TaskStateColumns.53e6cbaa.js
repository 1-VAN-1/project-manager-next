var N=Object.defineProperty;var B=(a,t,e)=>t in a?N(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var i=(a,t,e)=>(B(a,typeof t!="symbol"?t+"":t,e),e);import{l as U,r as M,_ as O,d as K,Q as k,o as u,c as h,F as R,j as A,a as r,t as n,U as T,s as m,B as G,n as j,g as C,S as x,a2 as E,D as f,x as F}from"./index.7ffa0279.js";import{T as P}from"./TaskService.d31c83d9.js";import{E as W,a as z}from"./index.64b5b789.js";import{T as p}from"./index.b78befe1.js";class y{constructor({titleLocaleKey:t,state:e,tasks:d}){i(this,"titleLocaleKey");i(this,"state");i(this,"tasks");this.titleLocaleKey=t,this.state=e,this.tasks=d}get totalDifficulty(){return this.tasks.map(e=>e.task.difficulty).reduce((e,d)=>e+d,0)}}class I{constructor(t){i(this,"_lowerLimit");i(this,"_upperLimit");i(this,"_step");i(this,"_timerInterval");i(this,"_value");i(this,"_timer",null);var e;if(t.step===0||t.lowerLimit===t.upperLimit)throw new Error("Invalid constructor options");this._value=t.value,this._lowerLimit=t.lowerLimit,this._upperLimit=t.upperLimit,this._step=t.step,this._timerInterval=(e=t.timerInterval)!=null?e:100}start(){this._timer!==null||this._isValueInBounds()===!1||(this._timer=setInterval(()=>{const t=this._value.get();if(this._isValueInBounds()===!1){const e=this._step<0?this._lowerLimit:this._upperLimit;e!==1/0&&this._value.set(e),this.stop();return}this._value.set(t+this._step)},this._timerInterval),this._value.set(this._value.get()+this._step))}stop(){var t,e;!this._timer||((e=(t=this._value).applyChange)==null||e.call(t),clearInterval(this._timer),this._timer=null)}_isValueInBounds(){const t=this._value.get();return this._step<0?Math.ceil(t)>this._lowerLimit&&Math.floor(t)<=this._upperLimit:Math.ceil(t)>=this._lowerLimit&&Math.floor(t)<this._upperLimit}}const b=U(),Q=async a=>{const t=await W.fetchEmployeeById(a);return(await z.getEmployee(t)).user};class w{constructor(t){i(this,"_taskDirector");i(this,"_infoToggled",!1);i(this,"_progressIncrementor");i(this,"_progressDecrementor");i(this,"_usedHoursIncrementor");i(this,"_usedHoursDecrementor");i(this,"task");this.task=t,Q(t.director).then(c=>this._taskDirector=c);const e={get:()=>this.task.progress,set:c=>{this.task.progress=c},applyChange:async()=>{b.setIsSyncIndicatorToggled(!0),await P.patchTask(this.task._id,{progress:this.task.progress}),b.setIsSyncIndicatorToggled(!1)}};this._progressIncrementor=new I({value:e,lowerLimit:0,upperLimit:1,step:.01}),this._progressDecrementor=new I({value:e,lowerLimit:0,upperLimit:1,step:-.01});const d={get:()=>this.task.usedHours,set:c=>{this.task.usedHours=c},applyChange:async()=>{b.setIsSyncIndicatorToggled(!0),await P.patchTask(this.task._id,{usedHours:this.task.usedHours}),b.setIsSyncIndicatorToggled(!1)}};this._usedHoursIncrementor=new I({value:d,lowerLimit:0,upperLimit:1/0,step:1}),this._usedHoursDecrementor=new I({value:d,lowerLimit:0,upperLimit:1/0,step:-1})}toggleInfo(){this._infoToggled=!this._infoToggled}startIncrementProgress(){this._progressIncrementor.start()}stopIncrementProgress(){this._progressIncrementor.stop()}startDecrementProgress(){this._progressDecrementor.start()}stopDecrementProgress(){this._progressDecrementor.stop()}startIncrementUsedHours(){this._usedHoursIncrementor.start()}stopIncrementUsedHours(){this._usedHoursIncrementor.stop()}startDecrementUsedHours(){this._usedHoursDecrementor.start()}stopDecrementUsedHours(){this._usedHoursDecrementor.stop()}get days(){const t=new Date(this.task.deadline),e=new Date,d=t.getTime()-e.getTime();return Math.round(d/(1e3*60*60*24))}get hours(){const t=new Date(this.task.deadline),e=new Date(this.task.startTime);return(t.getTime()-e.getTime())/(1e3*60*60)}get taskDirector(){return this._taskDirector}get infoToggled(){return this._infoToggled}}function q(a){const t=a.filter(o=>o.state===p.WAITING).map(o=>new w(o)),e=a.filter(o=>o.state===p.IN_PROGRESS).map(o=>new w(o)),d=a.filter(o=>o.state===p.STOPED).map(o=>new w(o)),c=a.filter(o=>o.state===p.CLOSED).map(o=>new w(o));return{taskStateColumns:M([new y({titleLocaleKey:"dashboard.WAITING",state:p.WAITING,tasks:t}),new y({titleLocaleKey:"dashboard.IN_PROGRESS",state:p.IN_PROGRESS,tasks:e}),new y({titleLocaleKey:"dashboard.STOPED",state:p.STOPED,tasks:d}),new y({titleLocaleKey:"dashboard.CLOSED",state:p.CLOSED,tasks:c})])}}const J={class:"state-columns-list"},X={class:"card state-column bg-white dark:bg-slate-800"},Y={class:"column-header"},Z={class:"text-gray-400 font-semibold text-lg"},tt={class:"difficulty-badge text-white bg-gray-400 dark:bg-gray-600"},st=["onClick"],et={class:"task dark:text-light"},ot={class:"text-lg font-semibold"},rt=["innerHTML"],at={class:"progress-bar bg-blue-100"},nt={class:"self-end text-gray-400 text-sm"},it={key:0},dt={key:1,class:"text-error"},lt={class:"task dark:text-light"},ct={class:"text-ellipsis overflow-hidden"},ut={class:"w-full flex gap-1 items-center"},ht={key:0,class:"ml-auto ignore"},pt=["onPointerdown","onPointerup","onPointerleave"],gt=["disabled","onPointerdown","onPointerup","onPointerleave"],_t={class:"w-full flex gap-1 items-center"},mt={key:0,class:"ml-auto ignore"},vt=["disabled","onPointerdown","onPointerup","onPointerleave"],ft=["disabled","onPointerdown","onPointerup","onPointerleave"],kt={class:"progress-bar bg-blue-100"},yt=K({__name:"TaskStateColumns",props:{employee:null,tasks:null,isInteractive:{type:Boolean}},setup(a){const t=a,{taskStateColumns:e}=q(t.tasks),d=U(),c=o=>{var g,_;return{project:(g=t.employee)==null?void 0:g.project,state:o,employee:(_=t.employee)==null?void 0:_._id}},D=async({newIndex:o},g)=>{const _=g.tasks[o];d.setIsSyncIndicatorToggled(!0),await P.patchTask(_.task._id,{state:g.state}),d.setIsSyncIndicatorToggled(!1)};return(o,g)=>{const _=k("b-icon-three-dots"),L=k("b-icon-plus"),S=k("b-icon-dash"),V=k("base-draggable");return u(),h("div",J,[(u(!0),h(R,null,A(F(e),v=>(u(),h("div",X,[r("div",Y,[r("span",Z,n(o.$t(v.titleLocaleKey)),1),r("div",tt,n(v.totalDifficulty)+" * ",1)]),a.isInteractive&&a.employee?(u(),h("div",{key:0,class:"add-task bg-gray-300 text-slate-400 unselectable",onClick:s=>o.$router.push({path:"taskCreation",query:c(v.state)})}," + "+n(o.$t("dashboard.addTask")),9,st)):T("",!0),m(V,{class:"task-list",list:v.tasks,disabled:!a.isInteractive,animation:"150",group:"tasks",itemKey:"id",filter:".ignore",onAdd:s=>D(s,v)},{item:G(({element:s})=>{var $,H;return[r("div",{class:j(["rounded-2xl shadow dark:shadow-slate-900",a.isInteractive?"cursor-move":"cursor-default"])},[m(_,{class:"text-2xl mx-auto cursor-pointer dark:text-white unselectable",onClick:l=>s.toggleInfo()},null,8,["onClick"]),C(r("div",et,[r("div",ot,n(s.task.title),1),r("p",{innerHTML:s.task.description},null,8,rt),r("div",at,[r("div",{class:"progress-bar-value bg-secondary",style:x({width:`${s.task.progress*100}%`,backgroundColor:`var(--difficulty-${s.task.difficulty})`})},null,4)]),r("div",nt,[s.days>=0?(u(),h("span",it," \u{1F557} "+n(s.days)+" "+n(o.$t("dashboard.daysLeft")),1)):(u(),h("span",dt,n(o.$t("dashboard.expired")),1))])],512),[[E,!s.infoToggled]]),C(r("div",lt,[r("div",ct,[r("strong",null,n(o.$t("dashboard.director"))+": ",1),f(" "+n(`${($=s.taskDirector)==null?void 0:$.name} ${((H=s.taskDirector)==null?void 0:H.surname)||""}`),1)]),r("div",null,[r("strong",null,n(o.$t("dashboard.standard"))+": ",1),f(n(Math.round(s.hours))+n(o.$t("dashboard.h")),1)]),r("div",ut,[r("strong",null,n(o.$t("dashboard.used"))+": ",1),f(" "+n(s.task.usedHours)+n(o.$t("dashboard.h"))+" ",1),a.isInteractive?(u(),h("span",ht,[r("button",{class:"btn-secondary p-1 rounded-lg text-xs mr-1",onPointerdown:l=>s.startIncrementUsedHours(),onPointerup:l=>s.stopIncrementUsedHours(),onPointerleave:l=>s.stopIncrementUsedHours()},[m(L)],40,pt),r("button",{class:"btn-secondary p-1 rounded-lg text-xs",disabled:s.task.usedHours===0,onPointerdown:l=>s.startDecrementUsedHours(),onPointerup:l=>s.stopDecrementUsedHours(),onPointerleave:l=>s.stopDecrementUsedHours()},[m(S)],40,gt)])):T("",!0)]),r("div",null,[r("strong",null,n(o.$t("dashboard.difficulty"))+":",1),f(" "+n(s.task.difficulty),1)]),r("div",_t,[r("strong",null,n(o.$t("dashboard.progress"))+": ",1),f(n(Math.trunc(s.task.progress*100))+"% ",1),a.isInteractive?(u(),h("span",mt,[r("button",{class:"btn-secondary p-1 rounded-lg text-xs mr-1",disabled:s.task.progress===1,onPointerdown:l=>s.startIncrementProgress(),onPointerup:l=>s.stopIncrementProgress(),onPointerleave:l=>s.stopIncrementProgress()},[m(L)],40,vt),r("button",{class:"btn-secondary p-1 rounded-lg text-xs",disabled:s.task.progress===0,onPointerdown:l=>s.startDecrementProgress(),onPointerup:l=>s.stopDecrementProgress(),onPointerleave:l=>s.stopDecrementProgress()},[m(S)],40,ft)])):T("",!0)]),r("div",kt,[r("div",{class:"progress-bar-value",style:x({width:`${s.task.progress*100}%`,backgroundColor:`var(--difficulty-${s.task.difficulty})`})},null,4)])],512),[[E,s.infoToggled]])],2)]}),_:2},1032,["list","disabled","onAdd"])]))),256))])}}});var Dt=O(yt,[["__scopeId","data-v-8a3791b4"]]);export{Dt as T};
