import{T as g}from"./TaskStateColumns.53e6cbaa.js";import{r as u,e as S,J as _,d as T,k as x,x as n,o as p,A as f,c as y,B as k,D as h,t as w,U as j,s as C,a1 as V}from"./index.7ffa0279.js";import{E as B,a as I,P as L,T as N}from"./index.64b5b789.js";import{E as U}from"./index.b78befe1.js";import{T as R}from"./TaskService.d31c83d9.js";import{L as A}from"./ListBox.70374e4b.js";import"./hidden.f8f3ff5c.js";function D(v,a){const t=u([]),r=u(),l=u([]),c=u(!0),s=u([]),d=async()=>{const e=await B.fetchEmployees({user:v,speciality:U.EXECUTOR});e.data.employees.length===0&&(s.value=[]),s.value=await I.getEmployeesFromIds(e)},m=async e=>{l.value=[];for(const i of e){const E=await L.fetchProjectById(i);l.value.push(E.data.project)}},o=async()=>{if(a.value===void 0||r.value===void 0)return;t.value=[];const e=await R.fetchTasks({employee:r.value._id,project:a.value});t.value=await N.getTasksFromIds(e)};return S(async()=>{var e;if(await d(),s.value.length===0){c.value=!1;return}a.value?r.value=s.value.find(i=>i.project===a.value):r.value=s.value[0],await m(s.value.map(i=>i.project)),a.value=(e=a.value)!=null?e:l.value[0]._id,await o(),c.value=!1}),_(a,async()=>{c.value=!0,r.value=s.value.find(e=>e.project===a.value),await o(),c.value=!1}),{tasks:t,projects:l,currentEmployee:r,isLoading:c}}const F={key:1},z={key:2,class:"w-full flex flex-col gap-2 items-center"},G=T({__name:"ExecutorPanelView",setup(v){const a=x();if(!a.credentials.user)throw"Unauthorized error";const t=u(localStorage.getItem("currentProject")||void 0);_(t,()=>{t.value&&localStorage.setItem("currentProject",t.value)});const{tasks:r,projects:l,currentEmployee:c,isLoading:s}=D(a.credentials.user.id,t);return(d,m)=>n(s)?(p(),f(V,{key:0,class:"w-full"})):n(l).length===0?(p(),y("div",F,"No projects")):(p(),y("div",z,[n(s)?j("",!0):(p(),f(A,{key:0,items:n(l).map(o=>o._id),modelValue:t.value,"onUpdate:modelValue":m[0]||(m[0]=o=>t.value=o),class:"w-40"},{title:k(({modelValue:o})=>{var e;return[h(w((e=n(l).find(i=>i._id===o))==null?void 0:e.title),1)]}),item:k(({item:o})=>{var e;return[h(w((e=n(l).find(i=>i._id===o))==null?void 0:e.title),1)]}),_:1},8,["items","modelValue"])),C(g,{employee:n(c),tasks:n(r),isInteractive:!0},null,8,["employee","tasks"])]))}});export{G as default};
