import{w as ue,d as M,r as w,b as L,p as ye,e as G,f as ge,O as V,i as be,_ as F,Q as T,o as I,A as E,B as k,a as c,s as _,x as g,C as N,R as ke,n as j,D,t as x,E as he,G as xe,l as de,c as H,S as Y,U as ce,F as we,j as Ie,J as te,V as Te,k as $e}from"./index.234d245d.js";import{u as Se}from"./useTasks.0f71ab4e.js";import{m as Ee,y as Ce,j as De,F as Re,o as S,i as Me,u as Pe,l as Z,P as Q,t as ae,b as Le,p as Fe,R as ne,c as $,v as Ae,M as le,D as pe,k as Oe}from"./hidden.84daa50f.js";import{x as je,a as R,L as Ne}from"./ListBox.1b697df6.js";import{T as U}from"./TaskService.7d7b11a1.js";import{N as Be,o as re,_ as Ve,U as Ue,f as Ke}from"./transition.88ee677d.js";import{T as ie,E as J}from"./index.6323af05.js";import{T as He}from"./TooltipPopper.7ddec554.js";import{E as z,a as X,P as qe,T as ze}from"./index.70c83123.js";function Ge({container:t,accept:a,walk:n,enabled:o}){ue(()=>{let e=t.value;if(!e||o!==void 0&&!o.value)return;let p=Ee(t);if(!p)return;let l=Object.assign(r=>a(r),{acceptNode:a}),f=p.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,l,!1);for(;f.nextNode();)n(f.currentNode)})}var Qe=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(Qe||{}),We=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(We||{});function Je(t){requestAnimationFrame(()=>requestAnimationFrame(t))}let me=Symbol("MenuContext");function W(t){let a=be(me,null);if(a===null){let n=new Error(`<${t} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,W),n}return a}let Xe=M({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(t,{slots:a,attrs:n}){let o=w(1),e=w(null),p=w(null),l=w([]),f=w(""),r=w(null),b=w(1);function v(m=u=>u){let u=r.value!==null?l.value[r.value]:null,y=Oe(m(l.value.slice()),d=>S(d.dataRef.domRef)),h=u?y.indexOf(u):null;return h===-1&&(h=null),{items:y,activeItemIndex:h}}let s={menuState:o,buttonRef:e,itemsRef:p,items:l,searchQuery:f,activeItemIndex:r,activationTrigger:b,closeMenu:()=>{o.value=1,r.value=null},openMenu:()=>o.value=0,goToItem(m,u,y){let h=v(),d=je(m===R.Specific?{focus:R.Specific,id:u}:{focus:m},{resolveItems:()=>h.items,resolveActiveIndex:()=>h.activeItemIndex,resolveId:i=>i.id,resolveDisabled:i=>i.dataRef.disabled});f.value="",r.value=d,b.value=y!=null?y:1,l.value=h.items},search(m){let u=f.value!==""?0:1;f.value+=m.toLowerCase();let y=(r.value!==null?l.value.slice(r.value+u).concat(l.value.slice(0,r.value+u)):l.value).find(d=>d.dataRef.textValue.startsWith(f.value)&&!d.dataRef.disabled),h=y?l.value.indexOf(y):-1;h===-1||h===r.value||(r.value=h,b.value=1)},clearSearch(){f.value=""},registerItem(m,u){let y=v(h=>[...h,{id:m,dataRef:u}]);l.value=y.items,r.value=y.activeItemIndex,b.value=1},unregisterItem(m){let u=v(y=>{let h=y.findIndex(d=>d.id===m);return h!==-1&&y.splice(h,1),y});l.value=u.items,r.value=u.activeItemIndex,b.value=1}};return Ce([e,p],(m,u)=>{var y;s.closeMenu(),De(u,Re.Loose)||(m.preventDefault(),(y=S(e))==null||y.focus())},L(()=>o.value===0)),ye(me,s),Me(L(()=>Pe(o.value,{[0]:Z.Open,[1]:Z.Closed}))),()=>{let m={open:o.value===0};return Q({ourProps:{},theirProps:t,slot:m,slots:a,attrs:n,name:"Menu"})}}}),Ye=M({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"}},setup(t,{attrs:a,slots:n,expose:o}){let e=W("MenuButton"),p=`headlessui-menu-button-${ae()}`;o({el:e.buttonRef,$el:e.buttonRef});function l(v){switch(v.key){case $.Space:case $.Enter:case $.ArrowDown:v.preventDefault(),v.stopPropagation(),e.openMenu(),V(()=>{var s;(s=S(e.itemsRef))==null||s.focus({preventScroll:!0}),e.goToItem(R.First)});break;case $.ArrowUp:v.preventDefault(),v.stopPropagation(),e.openMenu(),V(()=>{var s;(s=S(e.itemsRef))==null||s.focus({preventScroll:!0}),e.goToItem(R.Last)});break}}function f(v){switch(v.key){case $.Space:v.preventDefault();break}}function r(v){t.disabled||(e.menuState.value===0?(e.closeMenu(),V(()=>{var s;return(s=S(e.buttonRef))==null?void 0:s.focus({preventScroll:!0})})):(v.preventDefault(),e.openMenu(),Je(()=>{var s;return(s=S(e.itemsRef))==null?void 0:s.focus({preventScroll:!0})})))}let b=Le(L(()=>({as:t.as,type:a.type})),e.buttonRef);return()=>{var v;let s={open:e.menuState.value===0},m={ref:e.buttonRef,id:p,type:b.value,"aria-haspopup":!0,"aria-controls":(v=S(e.itemsRef))==null?void 0:v.id,"aria-expanded":t.disabled?void 0:e.menuState.value===0,onKeydown:l,onKeyup:f,onClick:r};return Q({ourProps:m,theirProps:t,slot:s,attrs:a,slots:n,name:"MenuButton"})}}}),Ze=M({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(t,{attrs:a,slots:n,expose:o}){let e=W("MenuItems"),p=`headlessui-menu-items-${ae()}`,l=w(null);o({el:e.itemsRef,$el:e.itemsRef}),Ge({container:L(()=>S(e.itemsRef)),enabled:L(()=>e.menuState.value===0),accept(s){return s.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:s.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(s){s.setAttribute("role","none")}});function f(s){var m;switch(l.value&&clearTimeout(l.value),s.key){case $.Space:if(e.searchQuery.value!=="")return s.preventDefault(),s.stopPropagation(),e.search(s.key);case $.Enter:if(s.preventDefault(),s.stopPropagation(),e.activeItemIndex.value!==null){let u=e.items.value[e.activeItemIndex.value];(m=S(u.dataRef.domRef))==null||m.click()}e.closeMenu(),pe(S(e.buttonRef));break;case $.ArrowDown:return s.preventDefault(),s.stopPropagation(),e.goToItem(R.Next);case $.ArrowUp:return s.preventDefault(),s.stopPropagation(),e.goToItem(R.Previous);case $.Home:case $.PageUp:return s.preventDefault(),s.stopPropagation(),e.goToItem(R.First);case $.End:case $.PageDown:return s.preventDefault(),s.stopPropagation(),e.goToItem(R.Last);case $.Escape:s.preventDefault(),s.stopPropagation(),e.closeMenu(),V(()=>{var u;return(u=S(e.buttonRef))==null?void 0:u.focus({preventScroll:!0})});break;case $.Tab:s.preventDefault(),s.stopPropagation(),e.closeMenu(),V(()=>Ae(S(e.buttonRef),s.shiftKey?le.Previous:le.Next));break;default:s.key.length===1&&(e.search(s.key),l.value=setTimeout(()=>e.clearSearch(),350));break}}function r(s){switch(s.key){case $.Space:s.preventDefault();break}}let b=Fe(),v=L(()=>b!==null?b.value===Z.Open:e.menuState.value===0);return()=>{var s,m;let u={open:e.menuState.value===0},y={"aria-activedescendant":e.activeItemIndex.value===null||(s=e.items.value[e.activeItemIndex.value])==null?void 0:s.id,"aria-labelledby":(m=S(e.buttonRef))==null?void 0:m.id,id:p,onKeydown:f,onKeyup:r,role:"menu",tabIndex:0,ref:e.itemsRef};return Q({ourProps:y,theirProps:t,slot:u,attrs:a,slots:n,features:ne.RenderStrategy|ne.Static,visible:v.value,name:"MenuItems"})}}}),B=M({name:"MenuItem",props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1}},setup(t,{slots:a,attrs:n,expose:o}){let e=W("MenuItem"),p=`headlessui-menu-item-${ae()}`,l=w(null);o({el:l,$el:l});let f=L(()=>e.activeItemIndex.value!==null?e.items.value[e.activeItemIndex.value].id===p:!1),r=L(()=>({disabled:t.disabled,textValue:"",domRef:l}));G(()=>{var u,y;let h=(y=(u=S(l))==null?void 0:u.textContent)==null?void 0:y.toLowerCase().trim();h!==void 0&&(r.value.textValue=h)}),G(()=>e.registerItem(p,r)),ge(()=>e.unregisterItem(p)),ue(()=>{e.menuState.value===0&&(!f.value||e.activationTrigger.value!==0&&V(()=>{var u,y;return(y=(u=S(l))==null?void 0:u.scrollIntoView)==null?void 0:y.call(u,{block:"nearest"})}))});function b(u){if(t.disabled)return u.preventDefault();e.closeMenu(),pe(S(e.buttonRef))}function v(){if(t.disabled)return e.goToItem(R.Nothing);e.goToItem(R.Specific,p)}function s(){t.disabled||f.value||e.goToItem(R.Specific,p,0)}function m(){t.disabled||!f.value||e.goToItem(R.Nothing)}return()=>{let{disabled:u}=t,y={active:f.value,disabled:u};return Q({ourProps:{id:p,ref:l,role:"menuitem",tabIndex:u===!0?void 0:-1,"aria-disabled":u===!0?!0:void 0,onClick:b,onFocus:v,onPointermove:s,onMousemove:s,onPointerleave:m,onMouseleave:m},theirProps:t,slot:y,attrs:n,slots:a,name:"MenuItem"})}}});const et={class:"flex content-center"},tt=M({__name:"DropDown",props:{position:null},setup(t){const a=o=>o==="downLeft"?"":o==="downRight"?"translate-x-full":o==="upLeft"?"-translate-y-full -top-2":o==="upRight"?"-translate-y-full translate-x-full -top-2":"",n=(o,e)=>{};return(o,e)=>{const p=T("b-icon-chevron-down");return I(),E(g(Xe),{as:"div",class:"menu"},{default:k(({open:l})=>[c("div",et,[_(g(Ye),{onClick:f=>n(f,l)},{default:k(()=>[N(o.$slots,"title",{},()=>[_(p)],!0)]),_:2},1032,["onClick"])]),_(ke,{"enter-active-class":"transition-transform ease-out duration-100","enter-from-class":"transition-transform opacity-0 scale-95","enter-to-class":"transition-transform opacity-100 scale-100","leave-active-class":"transition-transform ease-in duration-75","leave-from-class":"transition-transform opacity-100 scale-100","leave-to-class":"transition-transform opacity-0 scale-95"},{default:k(()=>[_(g(Ze),{class:j(["menu-items shadow-lg bg-white dark:bg-dark ring-1 ring-black ring-opacity-5 focus:outline-none",a(t.position)]),ref:"menuItems"},{default:k(()=>[N(o.$slots,"items",{},void 0,!0)]),_:3},8,["class"])]),_:3})]),_:3})}}});var ve=F(tt,[["__scopeId","data-v-b6a5f222"]]);const at=M({__name:"EmployeesTaskEditDropdown",props:{taskId:null},emits:["taskDelete","taskRemove"],setup(t){return(a,n)=>{const o=T("b-icon-three-dots"),e=T("b-icon-info-lg"),p=T("b-icon-pencil"),l=T("b-icon-x-lg"),f=T("b-icon-trash-2");return I(),E(ve,{position:"upLeft"},{title:k(()=>[_(o,{class:"text-2xl"})]),items:k(()=>[_(g(B),{onClick:n[0]||(n[0]=r=>a.$emit("taskDelete"))},{default:k(({active:r})=>[c("div",{class:j(["drop-down-item unselectable rounded-t-2xl",[r?"bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-200 ":"text-gray-900 dark:text-gray-400"]])},[_(e),D(" Info ")],2)]),_:1}),_(g(B),{onClick:n[1]||(n[1]=r=>a.$router.push(`taskUpdate/${t.taskId}`))},{default:k(({active:r})=>[c("div",{class:j(["drop-down-item unselectable",[r?"bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-200 ":"text-gray-900 dark:text-gray-400"]])},[_(p),D(" "+x(a.$t("dashboard.edit")),1)],2)]),_:1}),_(g(B),{onClick:n[2]||(n[2]=r=>a.$emit("taskRemove"))},{default:k(({active:r})=>[c("div",{class:j(["drop-down-item unselectable",[r?"bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-200 ":"text-gray-900 dark:text-gray-400"]])},[_(l),D(" "+x(a.$t("dashboard.remove")),1)],2)]),_:1}),_(g(B),{onClick:n[3]||(n[3]=r=>a.$emit("taskDelete"))},{default:k(({active:r})=>[c("div",{class:j(["drop-down-item unselectable rounded-b-2xl",[r?"bg-gray-100 dark:bg-gray-600 text-error/70":"text-error"]])},[_(f),D(" "+x(a.$t("dashboard.delete")),1)],2)]),_:1})]),_:1})}}});var st=F(at,[["__scopeId","data-v-0962b7b0"]]);const ot={};function nt(t,a){const n=T("b-icon-arrow-clockwise");return I(),E(n,{class:"animate-spin text-gray-400 self-center h-full text-3xl"})}var ee=F(ot,[["render",nt]]);const lt=t=>(he("data-v-5b13e873"),t=t(),xe(),t),rt=lt(()=>c("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)),it={class:"fixed inset-0 overflow-y-auto"},ut={class:"flex min-h-full items-center justify-center p-3 text-center"},dt={class:"mt-2"},ct={class:"text-sm text-gray-500 dark:text-gray-400"},pt={class:"buttons"},mt=M({__name:"ConfirmModal",props:{isOpen:{type:Boolean}},setup(t){return(a,n)=>(I(),E(g(Ke),{appear:"",show:t.isOpen,as:"template"},{default:k(()=>[_(g(Be),{as:"div",onClose:n[2]||(n[2]=o=>a.$emit("close")),class:"relative z-10"},{default:k(()=>[_(g(re),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:k(()=>[rt]),_:1}),c("div",it,[c("div",ut,[_(g(re),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:k(()=>[_(g(Ve),{class:"w-full max-w-md transform overflow-hidden rounded-3xl bg-white dark:bg-dark p-6 text-left align-middle shadow-xl transition-all"},{default:k(()=>[_(g(Ue),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900 dark:text-gray-200"},{default:k(()=>[N(a.$slots,"header",{},()=>[D(x(a.$t("modal.confirmDefaultHeader")),1)],!0)]),_:3}),c("div",dt,[c("p",ct,[N(a.$slots,"content",{},()=>[D(x(a.$t("modal.confirmDefaultBody")),1)],!0)])]),c("div",pt,[c("button",{type:"button",class:"btn-secondary text-sm focus:ring-0",onClick:n[0]||(n[0]=o=>a.$emit("continue"))},[N(a.$slots,"continue-button",{},()=>[D(x(a.$t("modal.continue")),1)],!0)]),c("button",{type:"button",class:"btn-error text-sm focus:ring-0",onClick:n[1]||(n[1]=o=>a.$emit("cancel"))},[N(a.$slots,"cancel-button",{},()=>[D(x(a.$t("modal.cancel")),1)],!0)])])]),_:3})]),_:3})])])]),_:3})]),_:3},8,["show"]))}});var fe=F(mt,[["__scopeId","data-v-5b13e873"]]);const vt={class:"card"},ft={class:"mb-4 w-full flex flex-col gap-2"},_t={class:"w-full flex flex-row justify-between gap-5"},yt={class:"text-lg font-semibold dark:text-light"},gt={class:"dark:text-light"},bt={class:"flex flex-row gap-1 items-center overflow-hidden"},kt={class:"task-title text-base font-semibold unselectable !text-dark"},ht={class:"difficulty-badge text-gray-600 dark:text-gray-800 bg-gray-300 dark:bg-gray-400 italic"},xt={class:"font-semibold"},wt={class:"font-normal"},It=M({__name:"EmployeeCard",props:{employee:null,director:null},emits:["taskRelease"],setup(t,{emit:a}){const n=t,{tasks:o,isLoading:e}=Se({employee:n.employee._id,project:n.employee.project,director:n.director}),p=L(()=>o.value.map(i=>i.difficulty).reduce((i,A)=>i+A,0)),l=d=>{const i=o.value.splice(d,1)[0];a("taskRelease",i._id)},f=de(),r=async d=>{const i=o.value[d];f.setIsSyncIndicatorToggled(!0),await U.deleteTask(i._id),o.value.splice(d,1),f.setIsSyncIndicatorToggled(!1)},b=w(!1);let v=w(()=>{});const s=d=>{b.value=!0,v.value=()=>{r(d),b.value=!1}},m=w(!1),u=async({newIndex:d})=>{const i=o.value[d];i.employee!==n.employee._id&&(f.setIsSyncIndicatorToggled(!0),await U.patchTask(i._id,{employee:n.employee._id}),i.employee=n.employee._id,f.setIsSyncIndicatorToggled(!1))},y=()=>{m.value=!0,Array.from(document.getElementsByClassName("dropdown")).forEach(i=>{i.getAttribute("data-headlessui-state")==="open"&&setTimeout(()=>{i.dispatchEvent(new Event("click"))},0)})},h=({deadline:d})=>new Date>new Date(d);return(d,i)=>{const A=T("b-icon-box-arrow-up-right"),q=T("router-link"),C=T("b-icon-check2-circle"),O=T("b-icon-slash-circle"),K=T("b-icon-exclamation-circle"),_e=T("base-draggable");return I(),H("div",vt,[c("div",ft,[c("div",_t,[c("div",yt,x(t.employee.user.name)+" "+x(t.employee.user.surname),1),_(q,{class:"btn-outline-secondary text-sm !opacity-100",to:`/employee/${t.employee._id}`},{default:k(()=>[_(A)]),_:1},8,["to"])]),c("div",gt,x(t.employee.user.skills),1)]),c("div",{class:"add-task border-gray-300 text-slate-400 unselectable",onClick:i[0]||(i[0]=P=>d.$router.push({path:"taskCreation",query:{project:t.employee.project,employee:t.employee._id}}))},x(d.$t("dashboard.addTask")),1),g(e)?(I(),E(ee,{key:0})):(I(),E(_e,{key:1,class:"task-list",list:g(o),animation:"150",group:"tasks",itemKey:"id",filter:".ignore",onAdd:u,onEnd:i[2]||(i[2]=P=>m.value=!1)},{item:k(({element:P,index:se})=>[_(He,{text:d.$t("dashboard."+P.state),"force-hide":m.value,delay:700},{default:k(()=>[c("div",{class:"task rounded-2xl shadow !border-none",style:Y({backgroundColor:`var(--difficulty-${P.difficulty})`}),onMousedown:y,onMouseup:i[1]||(i[1]=oe=>m.value=!1)},[c("div",bt,[P.state===g(ie).STOPED?(I(),E(C,{key:0,class:"min-w-max"})):P.state===g(ie).CLOSED?(I(),E(O,{key:1,class:"min-w-max"})):h(P)?(I(),E(K,{key:2,class:"min-w-max"})):ce("",!0),c("div",kt,x(P.title)+" ("+x(P.difficulty)+") ",1)]),_(st,{class:"ignore dropdown","task-id":P._id,onTaskRemove:oe=>l(se),onTaskDelete:oe=>s(se)},null,8,["task-id","onTaskRemove","onTaskDelete"])],36)]),_:2},1032,["text","force-hide"])]),_:1},8,["list"])),c("div",ht,[c("span",xt,x(d.$t("dashboard.totalDifficulty"))+": ",1),c("span",wt,x(g(p)),1)]),_(fe,{"is-open":b.value,onContinue:g(v),onCancel:i[3]||(i[3]=P=>b.value=!1)},null,8,["is-open","onContinue"])])}}});var Tt=F(It,[["__scopeId","data-v-f4db2a9e"]]);const $t={class:"employees-list"},St=M({__name:"EmployeesList",props:{employees:null,director:null},emits:["taskRelease"],setup(t,{emit:a}){const n=o=>{a("taskRelease",o)};return(o,e)=>(I(),H("div",$t,[(I(!0),H(we,null,Ie(t.employees,p=>(I(),E(Tt,{key:p._id,director:t.director,employee:p,onTaskRelease:n},null,8,["director","employee"]))),128))]))}});var Et=F(St,[["__scopeId","data-v-71bdbe9e"]]);const Ct=M({__name:"FreeTaskEditDropdown",props:{taskId:null,forceUpPosition:{type:Boolean}},emits:["taskDelete"],setup(t){return(a,n)=>{const o=T("b-icon-three-dots"),e=T("b-icon-pencil"),p=T("b-icon-trash-2");return I(),E(ve,{position:"upLeft"},{title:k(()=>[_(o,{class:"text-2xl"})]),items:k(()=>[_(g(B),{onClick:n[0]||(n[0]=l=>a.$router.push(`taskUpdate/${t.taskId}`))},{default:k(({active:l})=>[c("div",{class:j(["drop-down-item unselectable rounded-t-2xl",[l?"bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-200 ":"text-gray-900 dark:text-gray-400"]])},[_(e),D(" "+x(a.$t("dashboard.edit")),1)],2)]),_:1}),_(g(B),{onClick:n[1]||(n[1]=l=>a.$emit("taskDelete"))},{default:k(({active:l})=>[c("div",{class:j(["drop-down-item unselectable rounded-b-2xl",[l?"bg-gray-100 dark:bg-gray-600 text-error/70":"text-error"]])},[_(p),D(" "+x(a.$t("dashboard.delete")),1)],2)]),_:1})]),_:1})}}});var Dt=F(Ct,[["__scopeId","data-v-f1af5c90"]]);const Rt={class:"text-lg font-semibold unselectable w-max !text-dark"},Mt={class:"task-body"},Pt=["innerHTML"],Lt=M({__name:"FreeTasksList",props:{tasks:null},emits:["taskDelete","taskAdd"],setup(t){return(a,n)=>{const o=T("base-draggable");return I(),E(o,{class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",list:t.tasks,itemKey:"id",group:"tasks",animation:"150",filter:".ignore",handle:".handle",onAdd:n[0]||(n[0]=e=>a.$emit("taskAdd",e.newIndex))},{item:k(({element:e,index:p})=>[c("div",{class:"task border-4 rounded-3xl shadow-md",style:Y({borderColor:`var(--difficulty-${e.difficulty})`})},[c("div",{class:"task-header handle rounded-t-2xl !border-none",style:Y({backgroundColor:`var(--difficulty-${e.difficulty})`})},[c("div",Rt,x(e.title)+" ("+x(e.difficulty)+") ",1),_(Dt,{class:"ignore","task-id":e._id,onTaskDelete:l=>a.$emit("taskDelete",p)},null,8,["task-id","onTaskDelete"])],4),c("div",Mt,[c("p",{class:"text-dark dark:text-light text-center",innerHTML:e.description},null,8,Pt)])],4)]),_:1},8,["list"])}}});var Ft=F(Lt,[["__scopeId","data-v-72cb2c3c"]]);function At(t,a){const n=w(!0),o=w([]),e=w([]),p=w(),l=async()=>{const b=await z.fetchEmployees({user:t,speciality:J.MANAGER});return b.data.employees.length===0?[]:(await X.getEmployeesFromIds(b)).map(s=>s.project)},f=async b=>{const v=await z.fetchEmployees({user:t,project:b,speciality:J.MANAGER});if(v.data.employees.length===0)return;const s=await z.fetchEmployeeById(v.data.employees[0]);return await X.getEmployee(s)},r=async()=>{const b=await l();o.value=[];for(const v of b){const s=await z.fetchEmployees({speciality:J.EXECUTOR,project:v}),m=await X.getEmployeesFromIds(s);o.value.push(...m)}e.value=[];for(const v of b){const s=await qe.fetchProjectById(v);e.value.push(s.data.project)}};return G(async()=>{var b;await r(),e.value.length>0&&(a.value=(b=a.value)!=null?b:e.value[0]._id,p.value=await f(a.value)),n.value=!1}),te(a,async()=>{n.value=!0,await r(),a.value&&(p.value=await f(a.value)),n.value=!1}),{executors:o,projects:e,isLoading:n,manager:Te(p)}}function Ot(t){const a=w(!0),n=w([]),o=async()=>{if(t.value===void 0)return;const e=await U.fetchTasks({project:t.value,isFree:"1"});n.value=await ze.getTasksFromIds(e),a.value=!1};return G(async()=>{t.value&&(a.value=!0,await o())}),te(t,async()=>{a.value=!0,await o()}),{freeTasks:n,isLoading:a}}const jt={key:0},Nt={key:1,class:"outer"},Bt={class:"flex flex-col relative"},Vt={class:"header"},Ut={class:"hidden sm:block",style:{"line-height":"2.15rem"}},Kt={class:"flex flex-col relative"},Ht={class:"header"},qt={style:{"line-height":"2.15rem"}},zt=M({__name:"ManagerPanelView",setup(t){const a=de(),n=$e();if(!n.credentials.user)throw"Unauthorized error";const o=w(localStorage.getItem("currentProject")||void 0);te(o,()=>{o.value&&localStorage.setItem("currentProject",o.value)});const{executors:e,projects:p,manager:l,isLoading:f}=At(n.credentials.user.id,o),{freeTasks:r,isLoading:b}=Ot(o),v=async d=>{const i=r.value.filter(A=>A.project===o.value)[d];i.employee!==null&&(a.setIsSyncIndicatorToggled(!0),await U.patchTask(i._id,{employee:null}),i.employee=null,a.setIsSyncIndicatorToggled(!1))},s=async d=>{a.setIsSyncIndicatorToggled(!0);const i=await U.patchTask(d,{employee:null});r.value.push(i.data.task),a.setIsSyncIndicatorToggled(!1)},m=w(!1);let u=w(()=>{});const y=async d=>{a.setIsSyncIndicatorToggled(!0);const i=r.value.splice(d,1);await U.deleteTask(i[0]._id),a.setIsSyncIndicatorToggled(!1)},h=async d=>{m.value=!0,u.value=()=>{y(d),m.value=!1}};return(d,i)=>{var q;const A=T("b-icon-plus-lg");return!g(f)&&!g(l)?(I(),H("div",jt,"No projects")):(I(),H("div",Nt,[c("section",Bt,[c("div",Vt,[c("h2",Ut,x(d.$t("dashboard.project")),1),_(Ne,{items:g(p).map(C=>C._id),modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=C=>o.value=C),class:"w-40"},{title:k(({modelValue:C})=>{var O;return[D(x((O=g(p).find(K=>K._id===C))==null?void 0:O.title),1)]}),item:k(({item:C})=>{var O;return[D(x((O=g(p).find(K=>K._id===C))==null?void 0:O.title),1)]}),_:1},8,["items","modelValue"])]),g(f)?(I(),E(ee,{key:0})):(I(),E(Et,{key:1,director:(q=g(l))==null?void 0:q._id,employees:g(e).filter(C=>C.project===o.value),onTaskRelease:s},null,8,["director","employees"]))]),c("section",Kt,[c("div",Ht,[c("h2",qt,x(d.$t("dashboard.tasks")),1),c("button",{class:"btn-outline-secondary px-2 py-2 text-xs",onClick:i[1]||(i[1]=C=>d.$router.push({path:"taskCreation",query:{project:o.value}}))},[_(A)])]),g(b)?(I(),E(ee,{key:0})):ce("",!0),_(Ft,{tasks:g(r),onTaskDelete:h,onTaskAdd:v},null,8,["tasks"])]),_(fe,{"is-open":m.value,onContinue:g(u),onCancel:i[2]||(i[2]=C=>m.value=!1)},null,8,["is-open","onContinue"])]))}}});var aa=F(zt,[["__scopeId","data-v-bdb5c26a"]]);export{aa as default};
